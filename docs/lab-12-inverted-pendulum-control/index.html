<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Lab 12: Inverted Pendulum Control &ndash; MAE 4190 Fast Robots</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="robots" content="noindex"><link rel="icon" type="image/png" href="/favicon.png"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Open+Sans:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/app.min.css?v=4bbfd8a2"></head><body class="bg-white dark:bg-gray-950 text-gray-950 dark:text-gray-50 antialiased min-h-full overflow-x-hidden p-0 font-sans text-base leading-relaxed"><div class="mx-auto max-w-[45rem] px-4 sm:px-6"><nav class="flex justify-between mt-10 mb-16"><a class="block bg-brand-600 dark:bg-brand-400 px-2 text-xl sm:text-2xl font-mono font-bold tracking-tightest text-white dark:text-gray-950" href="/">MAE 4190 Fast Robots</a></nav><header class="my-6 space-y-5"><h1 class="text-5xl sm:text-6xl font-display font-bold tracking-tight text-gray-900 dark:text-gray-100">Lab 12: Inverted Pendulum Control</h1><div class="text-gray-500 dark:text-gray-400">May 15, 2024</div></header><article class="mt-12 prose prose-lg dark:prose-invert prose-headings:font-black prose-headings:tracking-tight"><aside class="text-base text-black dark:text-white px-7 py-6 space-y-5 border-l-4 rounded-md bg-orange-400/15 border-orange-400"><p class="font-black">Please note!</p><p>Jonathan gave me permission to submit my inverted pendulum implementation for Lab 12 instead of the original task of waypoint navigation. As such, the bulk of my work and discussion below do not relate to the typical Lab 12 material.</p></aside><p></p><p>In <a href="https://fastrobotscornell.github.io/FastRobots/labs/Lab12.html">Lab 12</a>, I embraced the open-endedness of our last assignment and worked on the challenge of turning the car into an inverted pendulum.</p><p>Before I get into the details of my pendulum experiments, I want to quickly outline what I would have done had I completed Lab 12 as written, so as to convey my understanding of the task. Broadly, I would have chosen local path planning and used a combination of <a href="/lab-11-real-localization">Lab 11</a>'s localization routine and the PID controllers from <a href="/lab-5-linear-pid-control">Lab 5</a> and <a href="/lab-6-orientation-pid-control">Lab 6</a> to navigate between waypoints in the arena. Put simply, I have spent a lot of time on developing those systems this semester and would have wanted to bring everything together for this lab. I would have additionally used the ToF sensors to avoid hitting the walls in the event of inaccurate localization, and orientation PID control to set headings for each next waypoint. I would also have used the IMU's DMP features to reliably track my orientation throughout the navigation process, thereby giving me at least some sense of the global state of the car in relation to the map.</p><p>I predict that I would have experienced challenges with accurate distance measurements while moving from point to point using linear PID control, because the ToF sensors would have underperformed when attempting to gather readings at odd angles. For example, when moving from waypoint #1 to #2, pulses sent by both my front and rear ToF sensors would have met the walls at roughly 45 degrees of incidence. Those pulses would likely have bounced away from the car and not yielded terribly accurate estimates of the distances to the walls, so it's highly probably that my car would have had trouble finding waypoint #2 on a first attempt. It would then have needed to localize part-way between the points and adjust accordingly. I predict I would have faced a similar issue between waypoints #3 and #4.</p><h2>An Alternate Objective</h2><p>In preparation for ECE Robotics Day on May 7th, I had been playing around with some additional ideas for stunts because I wasn't completely satisfied with the drift I managed in <a href="/lab-8-stunts">Lab 8</a>. One idea was to have the car do donuts on the floor of Duffield Atrium—"donuts" in this case being loosely defined as a circular drift maneuver sustained over a few seconds.</p><p>While working on the donut business, my friend and classmate <a href="https://leobrov.github.io/FastRobots_2024.html">Leo Dombrovski</a> was simultaneously trying to get inverted pendulum control working on his car. The morning of Robotics Day, Leo showed off the beginnings of a working solution, which inspired me to pursue the same challenge.</p><p>After some time tinkering with the basic premise—PID control on the pitch of the robot—I had a rough proof-of-concept running. The car could stand upright on its back wheels for a couple of seconds before falling over.</p><p>At this point, both Leo and I had drawn some attention from the crowd. Jonathan, our current instructor, and Prof. Peterson, who designed the class some years ago, were excited to see students tackle the classic dynamics problem on Fast Robots hardware.</p><p>By the end of Robotics Day, I had spent some five hours in Duffield, working first on my donut stunt and then the inverted pendulum problem. In recognition of our efforts, Jonathan offered Leo and I the option to write about the pendulum challenge for Lab 12 instead of the original waypoint navigation tasks. So here I am, doing just that.</p><h2>Implementation</h2><p>As I hinted previously, the crux of the inverted pendulum problem is a PID controller on the pitch of the car. Because of the way I had mounted my IMU earlier in the semester, an upright orientation of the robot on its rear wheels constituted a pitch measurement of 90 degrees. No matter, I thought, I could just subtract 90 from any given reading and get an error relative to a set point of 0 degrees—straight up. Unsurprisingly, it wasn't that easy.</p><p>As with all my IMU shenanigans lately, I used the DMP chip to get more accurate pitch readings. This required a small addition to the quaternion-Euler conversions I first described in <a href="/lab-6-orientation-pid-control">Lab 6</a>.</p><pre class="language-diff-cpp"><code class="language-diff-cpp"><span class="token unchanged language-cpp"><span class="token prefix unchanged"> </span><span class="token comment">// Convert to double, scale to +/- 1 by dividing by 2^30</span>
<span class="token prefix unchanged"> </span><span class="token keyword">double</span> qx <span class="token operator">=</span> dmp<span class="token punctuation">.</span>Quat6<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>Q1 <span class="token operator">/</span> <span class="token number">1073741824.0</span><span class="token punctuation">;</span>
<span class="token prefix unchanged"> </span><span class="token keyword">double</span> qy <span class="token operator">=</span> dmp<span class="token punctuation">.</span>Quat6<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>Q2 <span class="token operator">/</span> <span class="token number">1073741824.0</span><span class="token punctuation">;</span>
<span class="token prefix unchanged"> </span><span class="token keyword">double</span> qz <span class="token operator">=</span> dmp<span class="token punctuation">.</span>Quat6<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>Q3 <span class="token operator">/</span> <span class="token number">1073741824.0</span><span class="token punctuation">;</span>
</span>
<span class="token unchanged language-cpp"><span class="token prefix unchanged"> </span><span class="token keyword">double</span> qw <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>qx <span class="token operator">*</span> qx<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>qy <span class="token operator">*</span> qy<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>qz <span class="token operator">*</span> qz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span>
<span class="token diff bold language-cpp"><span class="token prefix diff">!</span><span class="token comment">// Pitch (y-axis rotation)</span>
<span class="token prefix diff">!</span><span class="token keyword">double</span> sinp <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>qw <span class="token operator">*</span> qy <span class="token operator">-</span> qx <span class="token operator">*</span> qz<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token prefix diff">!</span><span class="token keyword">double</span> pitch <span class="token operator">=</span> <span class="token function">asin</span><span class="token punctuation">(</span>sinp<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">180.0</span> <span class="token operator">/</span> PI <span class="token operator">-</span> <span class="token number">90.0</span><span class="token punctuation">;</span>
</span>
<span class="token unchanged language-cpp"><span class="token prefix unchanged"> </span><span class="token comment">// Yaw (z-axis rotation)</span>
<span class="token prefix unchanged"> </span><span class="token keyword">double</span> siny <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q0 <span class="token operator">*</span> qz <span class="token operator">+</span> qx <span class="token operator">*</span> qy<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token prefix unchanged"> </span><span class="token keyword">double</span> cosy <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">-</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>qy <span class="token operator">*</span> qy <span class="token operator">+</span> qz <span class="token operator">*</span> qz<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token prefix unchanged"> </span><span class="token keyword">double</span> yaw <span class="token operator">=</span> <span class="token function">atan2</span><span class="token punctuation">(</span>siny<span class="token punctuation">,</span> cosy<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">180.0</span> <span class="token operator">/</span> PI<span class="token punctuation">;</span>
</span></code></pre><p>Reading pitch and subtracting 90 degrees worked, in principle. Standing the car straight up yielded pitch readings of 0 degrees, just like I had wanted.</p><p>But there was a problem. The pitches on <em>both</em> sides of perfectly vertical were positive angles between 0 and 90, meaning there was no sense of direction. For PID control to work on pitch, I needed the slight rotations fore and aft of the desired vertical orientation to register as positive <em>and</em> negative angles, respectively. Leo gave me a good suggestion for how to adjust the math to achieve this, which I implemented in my own terms below.</p><pre class="language-cpp"><code class="language-cpp"><span class="token comment">// Pitch (y-axis rotation)</span>
<span class="token keyword">double</span> sinp <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>qw <span class="token operator">*</span> qy <span class="token operator">-</span> qx <span class="token operator">*</span> qz<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> cosy <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">-</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>qy <span class="token operator">*</span> qy <span class="token operator">+</span> qz <span class="token operator">*</span> qz<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> pitch <span class="token operator">=</span> <span class="token function">atan2</span><span class="token punctuation">(</span>sinp<span class="token punctuation">,</span> cosy<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">180.0</span> <span class="token operator">/</span> PI <span class="token operator">+</span> <span class="token number">90.0</span><span class="token punctuation">;</span></code></pre><p>The idea here is to take the <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="6.292ex" height="1.416ex" role="img" focusable="false" viewBox="0 -615 2781 626" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"><defs><path id="MJX-1-TEX-N-61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z"></path><path id="MJX-1-TEX-N-72" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T98 122T98 161T98 203Q98 234 98 269T98 328L97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 60 434T96 436Q112 437 131 438T160 441T171 442H174V373Q213 441 271 441H277Q322 441 343 419T364 373Q364 352 351 337T313 322Q288 322 276 338T263 372Q263 381 265 388T270 400T273 405Q271 407 250 401Q234 393 226 386Q179 341 179 207V154Q179 141 179 127T179 101T180 81T180 66V61Q181 59 183 57T188 54T193 51T200 49T207 48T216 47T225 47T235 46T245 46H276V0H267Q249 3 140 3Q37 3 28 0H20V46H36Z"></path><path id="MJX-1-TEX-N-63" d="M370 305T349 305T313 320T297 358Q297 381 312 396Q317 401 317 402T307 404Q281 408 258 408Q209 408 178 376Q131 329 131 219Q131 137 162 90Q203 29 272 29Q313 29 338 55T374 117Q376 125 379 127T395 129H409Q415 123 415 120Q415 116 411 104T395 71T366 33T318 2T249 -11Q163 -11 99 53T34 214Q34 318 99 383T250 448T370 421T404 357Q404 334 387 320Z"></path><path id="MJX-1-TEX-N-74" d="M27 422Q80 426 109 478T141 600V615H181V431H316V385H181V241Q182 116 182 100T189 68Q203 29 238 29Q282 29 292 100Q293 108 293 146V181H333V146V134Q333 57 291 17Q264 -10 221 -10Q187 -10 162 2T124 33T105 68T98 100Q97 107 97 248V385H18V422H27Z"></path><path id="MJX-1-TEX-N-6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="61" xlink:href="#MJX-1-TEX-N-61"></use><use data-c="72" xlink:href="#MJX-1-TEX-N-72" transform="translate(500,0)"></use><use data-c="63" xlink:href="#MJX-1-TEX-N-63" transform="translate(892,0)"></use><use data-c="74" xlink:href="#MJX-1-TEX-N-74" transform="translate(1336,0)"></use><use data-c="61" xlink:href="#MJX-1-TEX-N-61" transform="translate(1725,0)"></use><use data-c="6E" xlink:href="#MJX-1-TEX-N-6E" transform="translate(2225,0)"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>arctan</mi></math></mjx-assistive-mml></mjx-container> of the quaternion components to represent rotation about the <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.109ex" height="1.464ex" role="img" focusable="false" viewBox="0 -442 490 647" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"><defs><path id="MJX-2-TEX-I-1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D466" xlink:href="#MJX-2-TEX-I-1D466"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></mjx-assistive-mml></mjx-container> axis in the car's frame, rather than the <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="5.801ex" height="1.538ex" role="img" focusable="false" viewBox="0 -669 2564 680" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"><defs><path id="MJX-3-TEX-N-61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z"></path><path id="MJX-3-TEX-N-72" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T98 122T98 161T98 203Q98 234 98 269T98 328L97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 60 434T96 436Q112 437 131 438T160 441T171 442H174V373Q213 441 271 441H277Q322 441 343 419T364 373Q364 352 351 337T313 322Q288 322 276 338T263 372Q263 381 265 388T270 400T273 405Q271 407 250 401Q234 393 226 386Q179 341 179 207V154Q179 141 179 127T179 101T180 81T180 66V61Q181 59 183 57T188 54T193 51T200 49T207 48T216 47T225 47T235 46T245 46H276V0H267Q249 3 140 3Q37 3 28 0H20V46H36Z"></path><path id="MJX-3-TEX-N-63" d="M370 305T349 305T313 320T297 358Q297 381 312 396Q317 401 317 402T307 404Q281 408 258 408Q209 408 178 376Q131 329 131 219Q131 137 162 90Q203 29 272 29Q313 29 338 55T374 117Q376 125 379 127T395 129H409Q415 123 415 120Q415 116 411 104T395 71T366 33T318 2T249 -11Q163 -11 99 53T34 214Q34 318 99 383T250 448T370 421T404 357Q404 334 387 320Z"></path><path id="MJX-3-TEX-N-73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z"></path><path id="MJX-3-TEX-N-69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z"></path><path id="MJX-3-TEX-N-6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="61" xlink:href="#MJX-3-TEX-N-61"></use><use data-c="72" xlink:href="#MJX-3-TEX-N-72" transform="translate(500,0)"></use><use data-c="63" xlink:href="#MJX-3-TEX-N-63" transform="translate(892,0)"></use><use data-c="73" xlink:href="#MJX-3-TEX-N-73" transform="translate(1336,0)"></use><use data-c="69" xlink:href="#MJX-3-TEX-N-69" transform="translate(1730,0)"></use><use data-c="6E" xlink:href="#MJX-3-TEX-N-6E" transform="translate(2008,0)"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>arcsin</mi></math></mjx-assistive-mml></mjx-container> operation I had used before. Normally, doing this sort of thing in robotics comes with a caveat: gimbal lock at the poles. However, because my car's orientation is not directly controlled by 3D actuators and because gravity will happily resolve any singularity when pointing straight up, that was of no concern to me here.</p><p>With the pitch now measured with each cycle of the main control loop, I added an inverted pendulum PID controller to the Artemis, complete with filtering on the D term and a safety switch to stop the car if the pitch to either side of vertical exceeded 15 degrees, at which point the car was doomed to fall.</p><pre class="language-cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PITCH_SAFETY</span> <span class="token expression"><span class="token number">15</span> </span><span class="token comment">// degrees</span></span>

<span class="token keyword">void</span> <span class="token function">pidPenControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    last_pid_time <span class="token operator">=</span> current_pid_time<span class="token punctuation">;</span>
    current_pid_time <span class="token operator">=</span> <span class="token function">micros</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1.e6</span><span class="token punctuation">;</span> <span class="token comment">// secs</span>
    pid_dt <span class="token operator">=</span> current_pid_time <span class="token operator">-</span> last_pid_time<span class="token punctuation">;</span>

    last_error <span class="token operator">=</span> current_error<span class="token punctuation">;</span>
    current_error <span class="token operator">=</span> current_pitch_reading <span class="token operator">-</span> pid_pen_target<span class="token punctuation">;</span>

    P_term <span class="token operator">=</span> Kp_pen <span class="token operator">*</span> current_error<span class="token punctuation">;</span>

    error_integral <span class="token operator">=</span> <span class="token function">constrain</span><span class="token punctuation">(</span>error_integral <span class="token operator">+</span> current_error <span class="token operator">*</span> pid_dt<span class="token punctuation">,</span> <span class="token operator">-</span>INTEGRAL_THRESHOLD<span class="token punctuation">,</span> INTEGRAL_THRESHOLD<span class="token punctuation">)</span><span class="token punctuation">;</span>
    I_term <span class="token operator">=</span> Ki_pen <span class="token operator">*</span> error_integral<span class="token punctuation">;</span>

    D_term <span class="token operator">=</span> Kd_pen <span class="token operator">*</span> <span class="token punctuation">(</span>current_error <span class="token operator">-</span> last_error<span class="token punctuation">)</span> <span class="token operator">/</span> pid_dt<span class="token punctuation">;</span>

    last_filtered_D_term <span class="token operator">=</span> filtered_D_term<span class="token punctuation">;</span>
    filtered_D_term <span class="token operator">=</span> D_LPF_ALPHA <span class="token operator">*</span> D_term <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>D_LPF_ALPHA<span class="token punctuation">)</span> <span class="token operator">*</span> last_filtered_D_term<span class="token punctuation">;</span>

    speed <span class="token operator">=</span> <span class="token number">0.01</span> <span class="token operator">*</span> <span class="token punctuation">(</span>P_term <span class="token operator">+</span> I_term <span class="token operator">+</span> filtered_D_term<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag_enable_motors<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token comment">// Stop motors if the car is tilted too far or the speed is insufficient</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>current_error<span class="token punctuation">)</span> <span class="token operator">&gt;</span> PITCH_SAFETY <span class="token operator">||</span> <span class="token function">abs</span><span class="token punctuation">(</span>speed<span class="token punctuation">)</span> <span class="token operator">&lt;</span> pid_pen_threshold<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">idleMotors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">driveMotors</span><span class="token punctuation">(</span>speed<span class="token punctuation">,</span> speed<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>The gains I had landed on during Robotics Day were a <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: -0.65ex;" xmlns="http://www.w3.org/2000/svg" width="2.913ex" height="2.195ex" role="img" focusable="false" viewBox="0 -683 1287.7 970.2" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"><defs><path id="MJX-4-TEX-I-1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path><path id="MJX-4-TEX-I-1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D43E" xlink:href="#MJX-4-TEX-I-1D43E"></use></g><g data-mml-node="mi" transform="translate(882,-150) scale(0.707)"><use data-c="1D45D" xlink:href="#MJX-4-TEX-I-1D45D"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>K</mi><mi>p</mi></msub></math></mjx-assistive-mml></mjx-container> of 2.7 and a <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: -0.355ex;" xmlns="http://www.w3.org/2000/svg" width="2.94ex" height="1.901ex" role="img" focusable="false" viewBox="0 -683 1299.7 840.1" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"><defs><path id="MJX-5-TEX-I-1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path><path id="MJX-5-TEX-I-1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D43E" xlink:href="#MJX-5-TEX-I-1D43E"></use></g><g data-mml-node="mi" transform="translate(882,-150) scale(0.707)"><use data-c="1D451" xlink:href="#MJX-5-TEX-I-1D451"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>K</mi><mi>d</mi></msub></math></mjx-assistive-mml></mjx-container> of -0.4. I ended up zeroing out the <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.661ex" height="1.902ex" role="img" focusable="false" viewBox="0 -683 1176 840.8" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"><defs><path id="MJX-6-TEX-I-1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path><path id="MJX-6-TEX-I-1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D43E" xlink:href="#MJX-6-TEX-I-1D43E"></use></g><g data-mml-node="mi" transform="translate(882,-150) scale(0.707)"><use data-c="1D456" xlink:href="#MJX-6-TEX-I-1D456"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>K</mi><mi>i</mi></msub></math></mjx-assistive-mml></mjx-container> term because it didn't seem to help in any significant way, ultimately leaving me with a PD controller. The video below shows this in action.</p><p><iframe class="w-full aspect-video outline-none border-none" src="https://www.youtube-nocookie.com/embed/J95-tL0hWKM?rel=0" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p><p>I then spent some additional time tuning the gains and the motor control to improve the car's stability. My final gains were a <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: -0.65ex;" xmlns="http://www.w3.org/2000/svg" width="2.913ex" height="2.195ex" role="img" focusable="false" viewBox="0 -683 1287.7 970.2" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"><defs><path id="MJX-7-TEX-I-1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path><path id="MJX-7-TEX-I-1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D43E" xlink:href="#MJX-7-TEX-I-1D43E"></use></g><g data-mml-node="mi" transform="translate(882,-150) scale(0.707)"><use data-c="1D45D" xlink:href="#MJX-7-TEX-I-1D45D"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>K</mi><mi>p</mi></msub></math></mjx-assistive-mml></mjx-container> of 2.4 and a <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: -0.355ex;" xmlns="http://www.w3.org/2000/svg" width="2.94ex" height="1.901ex" role="img" focusable="false" viewBox="0 -683 1299.7 840.1" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"><defs><path id="MJX-8-TEX-I-1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path><path id="MJX-8-TEX-I-1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D43E" xlink:href="#MJX-8-TEX-I-1D43E"></use></g><g data-mml-node="mi" transform="translate(882,-150) scale(0.707)"><use data-c="1D451" xlink:href="#MJX-8-TEX-I-1D451"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>K</mi><mi>d</mi></msub></math></mjx-assistive-mml></mjx-container> of -0.3. The video and plot below show the results.</p><p><iframe class="w-full aspect-video outline-none border-none" src="https://www.youtube-nocookie.com/embed/ioA5IQkiZAE?rel=0" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p><img alt="Pendulum test data" src="/img/lab12_pendulum.png" width="1000" height="600"><p>Next, I added support for a spin speed so that the car could turn on-axis while keeping itself upright. I figured that a bit of spin would help stabilize the system, plus it would look cool and demonstrate greater control over the robot. This next video shows an example.</p><p><iframe class="w-full aspect-video outline-none border-none" src="https://www.youtube-nocookie.com/embed/gnF7CF_CDmw?rel=0" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p><p>My second spin test went better. I also recorded data for this one.</p><p><iframe class="w-full aspect-video outline-none border-none" src="https://www.youtube-nocookie.com/embed/A2AtABnYFzA?rel=0" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p><img alt="Pendulum spin test data" src="/img/lab12_pendulum_spin.png" width="1000" height="600"><p>I then tried to increase the spin speed a little. It went okay for a bit before the car ran off on me.</p><p><iframe class="w-full aspect-video outline-none border-none" src="https://www.youtube-nocookie.com/embed/JBCGjgGGhgo?rel=0" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p><p>And lastly, here's a test of considerably faster spin. It... didn't go well. That much spin was just too unstable.</p><p><iframe class="w-full aspect-video outline-none border-none" src="https://www.youtube-nocookie.com/embed/CNwIYoiJO-g?rel=0" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p><p>All in all, the inverted pendulum control isn't perfect because the motors aren't terribly precise and the wheels aren't completely smooth and round, but it's pretty darn good and brings a huge smile to my face every time I play with it. Perhaps some long, thin extensions on the chassis could help stabilize the system, but I wanted to get as close with the car on its own as I could.</p><p>There are still some other ideas that could be applied to this. Had my motors been strong enough to perform a flip in <a href="/lab-8-stunts">Lab 8</a>, I would tried to get the car to stand up and self-balance from a typical resting position, but alas, this was not within my reach. Maybe this effect could still be achieved by driving the car into a wall to induce a flip. I leave that as a reader's exercise.</p><h2>Conclusion</h2><p>This lab was an unexpectedly fun adventure. What started out as a friendly competition between Leo and I on ECE Robotics Day turned into a valuable exploration of complex dynamics. I only wish more students could have had the chance to pursue this challenge.</p><p>As this marks the end of Fast Robots for this year, I want to say a very warm thank you to Jonathan and the wonderful TAs who have all been so kind, helpful, and supportive throughout the semester. This was one of my favorite classes I've ever taken at Cornell, and I count myself lucky that I got to experience it with such awesome people!</p><p>Thank you and good bye!</p></article><footer class="mt-20 mb-10 sm:flex justify-between text-base/7 text-center text-gray-400 dark:text-gray-600"><p>MAE 4190 Fast Robots at Cornell University</p><p>© Spring 2024</p></footer></div></body></html>