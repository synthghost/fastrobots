<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Lab 1A: Artemis &ndash; MAE 4190 Fast Robots</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="robots" content="noindex"><link rel="icon" type="image/png" href="/favicon.png"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Open+Sans:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/app.min.css"></head><body class="bg-white dark:bg-gray-950 text-gray-950 dark:text-gray-50 antialiased min-h-full overflow-x-hidden p-0 font-sans text-base leading-relaxed"><div class="mx-auto max-w-[45rem] px-4 sm:px-6"><nav class="flex justify-between mt-10 mb-16"><a class="block bg-brand-600 dark:bg-brand-400 px-2 text-xl sm:text-2xl font-mono font-bold tracking-tightest text-white dark:text-gray-950" href="/">MAE 4190 Fast Robots</a></nav><header class="my-6 space-y-5"><h1 class="text-5xl sm:text-6xl font-display font-bold tracking-tight text-gray-900 dark:text-gray-100">Lab 1A: Artemis</h1><div class="text-gray-500 dark:text-gray-400">February 6, 2024 | 714 words</div></header><article class="mt-12 prose prose-lg dark:prose-invert prose-headings:font-black prose-headings:tracking-tight"><aside class="text-base text-black dark:text-white px-7 py-6 space-y-5 border-l-4 rounded-md bg-blue-400/15 border-blue-400"><p>This is Part A of a two-part writeup for Lab 1. The next part is <a href="/lab-1b-bluetooth">Part B</a>.</p></aside><p></p><p>The <a href="https://www.sparkfun.com/products/15443">SparkFun RedBoard Artemis Nano</a> is a compact microcontroller equipped with 17 I/O pins, 8 analog-to-digital conversion channels, 2 asynchronous receiver/transmitters, 4 I<sup>2</sup>C buses, 2 serial buses, a pulse density microphone, Bluetooth connectivity, and a Qwiic connector.</p><p>In Part A of <a href="https://fastrobotscornell.github.io/FastRobots/labs/Lab1_new.html">Lab 1</a>, I configured my MacBook for Artemis development and tested some of the board's features.</p><img alt="SparkFun RedBoard Artemis Nano" src="/img/lab1a_artemis.jpg" width="1400" height="934"><h2>Prelab</h2><p>To prepare for Part A of the lab, I installed the latest <a href="https://www.arduino.cc/en/software">Arduino IDE</a> (v2.2.1) on my Mac running macOS 12 Monterey.</p><h2>Tasks</h2><h3>Task 1: Installation</h3><p>I started the lab by connecting the Artemis Nano to my Mac via USB C. I then followed the Artemis <a href="https://learn.sparkfun.com/tutorials/artemis-development-with-arduino">setup instructions</a> provided by SparkFun. Based on those instructions, I added SparkFun's <a href="https://learn.sparkfun.com/tutorials/artemis-development-with-arduino#arduino-installation">Apollo3 Arduino Core</a> to the Board Manager in Arduino IDE and then installed the "SparkFun Apollo3" board package.</p><img alt="Arduino IDE Board Manager" src="/img/lab1a_task_1.png" width="1400" height="875"><h3>Task 2: Blink</h3><p>To confirm the Artemis board installation, I ran the Arduino IDE "Blink" example sketch, <code>Examples &gt; 01.Basics &gt; Blink</code>, which switches the board's built-in LED on and off on a one-second cycle.</p><p><iframe class="w-full aspect-video outline-none border-none" src="https://www.youtube-nocookie.com/embed/EwxIg0qYbmQ?rel=0" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p><h3>Task 3: Serial</h3><p>To test serial communication, I uploaded the Artemis "Serial" example sketch, <code>Examples &gt; Apollo3 &gt; Example04_Serial</code>, which prints a few messages and then listens for inputs to echo back. To match the sketch, I set the serial monitor <em>baud rate</em> to <code>115200</code>.</p><img alt="Arduino IDE serial example" src="/img/lab1a_task_3.png" width="1400" height="875"><h3>Task 4: Temperature</h3><p>The Artemis board has an integrated temperature sensor. To test it, I ran the Artemis "AnalogRead" example sketch, <code>Examples &gt; Apollo3 &gt; Example02_AnalogRead</code>, which continuously prints a raw temperature sensor reading to the serial monitor.</p><img alt="Arduino IDE temperature readings" src="/img/lab1a_task_4a.png" width="1400" height="875"><p>The raw temperature data isn't particularly human-friendly, so I modified the example sketch to instead print readings in Celsius and Fahrenheit.</p><pre class="language-cpp"><code class="language-cpp"><span class="token comment">// Serial.printf("temp (counts): %d, ...\n", temp_raw, ...);</span>
Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"deg_C:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">getTempDegC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">",deg_F:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getTempDegF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>I then used the Arduino IDE serial plotter feature to visualize the temperature data in real time while warming the Artemis with my hand.</p><p><iframe class="w-full aspect-video outline-none border-none" src="https://www.youtube-nocookie.com/embed/wEt4THwVemY?rel=0" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p><p>Holding the Artemis only had a modest effect on the temperature reading, so I tried placing the board near a light bulb and then taking it away again while plotting at a very slow baud rate of <code>300</code>. This approach induced a more dramatic trend in the data over time.</p><img alt="Arduino IDE temperature plot" src="/img/lab1a_task_4b.png" width="1400" height="875"><h3>Task 5: Microphone</h3><p>For the last example, I uploaded the Artemis "MicrophoneOutput" sketch, <code>Examples &gt; PDM &gt; Example1_MicrophoneOutput</code>, which continuously reports the loudest frequency the microphone detects at any given moment.</p><p>To test the microphone against a source of known frequencies, I used a piano simulator on my Mac to play three notes: <strong>F4</strong> (349 Hz), <strong>A4</strong> (440 Hz), and <strong>C5</strong> (523 Hz). I played a somewhat random sequence, repeating each note twice overall. The microphone measured the frequencies fairly accurately, reporting 354 Hz, 446 Hz, and 526 Hz for the notes, respectively.</p><p><iframe class="w-full aspect-video outline-none border-none" src="https://www.youtube-nocookie.com/embed/EfSVyGwO4q4?rel=0" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p><h3>Optional 5000-Level: Musical Tuning</h3><p>I'm enrolled in the 4000-level course, but I wanted to try out the extra material. To have the onboard LED illuminate when playing a musical note "A", I modified the "MicrophoneOutput" example sketch from Task 5. I first set the LED I/O pin to output mode.</p><pre class="language-cpp"><code class="language-cpp"><span class="token comment">// In setup():</span>
<span class="token function">pinMode</span><span class="token punctuation">(</span>LED_BUILTIN<span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>I then defined a few variables: the target frequency of 440 Hz for an A4 note, a high-pass cutoff to avoid low frequency noise, and an approximation factor to account for slight variance in the microphone readings. I used these values to test for an A4 and set the voltage on the LED accordingly.</p><pre class="language-cpp"><code class="language-cpp"><span class="token comment">// In printLoudest():</span>
<span class="token keyword">uint32_t</span> ui32Note <span class="token operator">=</span> ui32LoudestFrequency<span class="token punctuation">;</span>
<span class="token keyword">uint16_t</span> freqA4 <span class="token operator">=</span> <span class="token number">440</span><span class="token punctuation">;</span> <span class="token comment">// LED frequency</span>
<span class="token keyword">uint8_t</span> cutoff <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token keyword">uint8_t</span> blur <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>

<span class="token keyword">bool</span> isA4 <span class="token operator">=</span> ui32Note <span class="token operator">&gt;</span> freqA4 <span class="token operator">-</span> blur <span class="token operator">&amp;&amp;</span> ui32Note <span class="token operator">&lt;</span> freqA4 <span class="token operator">+</span> blur<span class="token punctuation">;</span>
<span class="token function">digitalWrite</span><span class="token punctuation">(</span>LED_BUILTIN<span class="token punctuation">,</span> isA4 <span class="token operator">?</span> HIGH <span class="token operator">:</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>With detection of one note complete, I further modified the sketch to define frequencies for the remaining notes in the fourth standard octave (C4 - B4).</p><pre class="language-cpp"><code class="language-cpp"><span class="token keyword">uint16_t</span> freqC4 <span class="token operator">=</span> <span class="token number">262</span><span class="token punctuation">;</span>
<span class="token keyword">uint16_t</span> freqCs4 <span class="token operator">=</span> <span class="token number">277</span><span class="token punctuation">;</span>
<span class="token keyword">uint16_t</span> freqD4 <span class="token operator">=</span> <span class="token number">294</span><span class="token punctuation">;</span>
<span class="token keyword">uint16_t</span> freqEb4 <span class="token operator">=</span> <span class="token number">311</span><span class="token punctuation">;</span>
<span class="token keyword">uint16_t</span> freqE4 <span class="token operator">=</span> <span class="token number">330</span><span class="token punctuation">;</span>
<span class="token keyword">uint16_t</span> freqF4 <span class="token operator">=</span> <span class="token number">349</span><span class="token punctuation">;</span>
<span class="token keyword">uint16_t</span> freqFs4 <span class="token operator">=</span> <span class="token number">370</span><span class="token punctuation">;</span>
<span class="token keyword">uint16_t</span> freqG4 <span class="token operator">=</span> <span class="token number">392</span><span class="token punctuation">;</span>
<span class="token keyword">uint16_t</span> freqAb4 <span class="token operator">=</span> <span class="token number">415</span><span class="token punctuation">;</span>
<span class="token keyword">uint16_t</span> freqA4 <span class="token operator">=</span> <span class="token number">440</span><span class="token punctuation">;</span> <span class="token comment">// LED frequency</span>
<span class="token keyword">uint16_t</span> freqBb4 <span class="token operator">=</span> <span class="token number">466</span><span class="token punctuation">;</span>
<span class="token keyword">uint16_t</span> freqB4 <span class="token operator">=</span> <span class="token number">494</span><span class="token punctuation">;</span></code></pre><p>I wanted to make the tuner effective for more than just this specific set of pitches. Because the frequency of any given note <strong>doubles</strong> or <strong>halves</strong> when ascending or descending octaves, respectively, I could detect a wide range of notes with two loops to modulate the loudest frequency measured by the microphone to an equivalent pitch in the fourth octave.</p><pre class="language-cpp"><code class="language-cpp"><span class="token comment">// Repeatedly double the frequency up until the fourth octave</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>ui32Note <span class="token operator">&gt;</span> cutoff <span class="token operator">&amp;&amp;</span> ui32Note <span class="token operator">&lt;</span> freqC4 <span class="token operator">-</span> blur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ui32Note <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Repeatedly halve the frequency down until the fourth octave</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>ui32Note <span class="token operator">&gt;</span> cutoff <span class="token operator">&amp;&amp;</span> ui32Note <span class="token operator">&gt;</span> freqB4 <span class="token operator">+</span> blur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ui32Note <span class="token operator">/=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>I then used the modulated frequency and the defined set of pitches to conditionally print the corresponding note to the serial monitor.</p><pre class="language-cpp"><code class="language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span>ui32Note <span class="token operator">&lt;</span> freqC4 <span class="token operator">+</span> blur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>ui32Note <span class="token operator">&gt;</span> freqCs4 <span class="token operator">-</span> blur <span class="token operator">&amp;&amp;</span> ui32Note <span class="token operator">&lt;</span> freqCs4 <span class="token operator">+</span> blur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"C#"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>ui32Note <span class="token operator">&gt;</span> freqD4 <span class="token operator">-</span> blur <span class="token operator">&amp;&amp;</span> ui32Note <span class="token operator">&lt;</span> freqD4 <span class="token operator">+</span> blur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"D"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// and so on...</span></code></pre><p>Running this on the Artemis created a pretty decent musical tuner that lights up for the note "A".</p><p><iframe class="w-full aspect-video outline-none border-none" src="https://www.youtube-nocookie.com/embed/pk6kqWS8GxI?rel=0" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p><h2>Conclusion</h2><p>This lab has shown me that the Artemis Nano is a nifty little board, somewhat similar to the Arduinos I've worked with in the past. New to me were the integrated temperature sensor and microphone, and I enjoyed the added exercise of making a musical tuner.</p></article><footer class="mt-20 mb-10 sm:flex justify-between text-base/7 text-center text-gray-400 dark:text-gray-600"><p>MAE 4190 Fast Robots at Cornell University</p><p>© Spring 2024</p></footer></div></body></html>